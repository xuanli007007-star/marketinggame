<!doctype html>
<html lang="zh-CN">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1,viewport-fit=cover">
<title>å¢¨åŸç­”é¢˜Â·åˆ·åˆ†åœº</title>
<meta name="description" content="æƒ³ç­”å‡ é¢˜å°±å‡ é¢˜ï¼Œç§¯åˆ†ä¸æ–­æ¶¨ï¼›æ¯æ»¡3é¢˜ï¼Œä¸‹1é¢˜åŒå€å¥–åŠ±ï¼">
<style>
:root{
  --primary:#00C2A8; --accent:#7C3AED; --ink:#E8ECFF; --muted:#9CA3AF;
  --bg:#0B1020; --card:#0E1226; --ok:#16A34A; --err:#DC2626; --ring:#2B3257;
}
*{box-sizing:border-box} html,body{height:100%}
body{margin:0; background:#0B1020; color:var(--ink);
  font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Noto Sans,Helvetica,Arial}

/* èƒŒæ™¯ */
.bg-wrap{position:fixed; inset:0; z-index:-2; overflow:hidden}
.bg-grad{position:absolute; inset:-20%;
  background:
    radial-gradient(1000px 600px at 70% -10%, #1B2250 0%, transparent 60%),
    radial-gradient(1200px 800px at 10% 120%, #171E46 0%, transparent 60%),
    radial-gradient(900px 700px at 90% 60%, #0F1640 0%, transparent 65%),
    linear-gradient(180deg, #080B20, #0B1020);
  filter:saturate(1.2) contrast(1.05);
}
canvas#bg,canvas#fx{position:fixed; inset:0; z-index:-1; pointer-events:none}
.neon{filter:drop-shadow(0 0 6px rgba(0,194,168,.65)) drop-shadow(0 0 18px rgba(124,58,237,.45))}

/* å¸ƒå±€ */
.page{max-width:960px;margin:0 auto;padding:22px}
.hero{padding-top:16px}
.brand{display:flex;align-items:center;gap:16px}
.logo{width:48px;height:48px;border-radius:14px;display:flex;align-items:center;justify-content:center;
  font-weight:800;color:#01211C;letter-spacing:.5px;
  background:conic-gradient(from 180deg at 50% 50%, var(--primary), #47E5D2, var(--primary));
  box-shadow:0 8px 24px rgba(0,194,168,.45), inset 0 0 12px rgba(255,255,255,.35);
}
.titles h1{margin:0 0 6px 0;color:#FDFDFE;font-weight:800}
.subtitle{margin:0;color:#C7CBD6}
.chip{margin-left:auto;background:#0E142C;color:#F5F8FC;border:1px solid #2C335A;border-radius:999px;padding:8px 14px;font-weight:700;
  box-shadow:inset 0 0 12px rgba(124,58,237,.25), 0 8px 18px rgba(0,0,0,.35)}
.statbar{display:flex; gap:8px; margin-top:10px; align-items:center; color:#BFC6EF; font-size:13px}
.stat{background:#0E1430;border:1px solid #2F3766;border-radius:10px;padding:6px 10px}

/* å¡ç‰‡ */
.card{position:relative;margin-top:18px;border-radius:18px;padding:20px;background:linear-gradient(180deg,#0F1430,#0B1026);
  border:1px solid #2B3257; box-shadow:0 12px 30px rgba(0,0,0,.45), inset 0 0 0 1px rgba(255,255,255,.02)}
.card::before{content:""; position:absolute; inset:-1px; border-radius:19px; padding:1px;
  background:conic-gradient(from 0deg, rgba(124,58,237,.6), rgba(0,194,168,.6), rgba(124,58,237,.6));
  -webkit-mask:linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
  -webkit-mask-composite:xor; mask-composite:exclude; animation:borderSpin 6s linear infinite; opacity:.5}
@keyframes borderSpin{to{transform:rotate(360deg)}}

.meta{display:flex;align-items:center;gap:8px;margin-bottom:6px}
.badge{font-size:12px;color:#0C4036;background:#08312C;border:1px solid #1AA58E;border-radius:6px;padding:4px 8px}
.muted{color:#8B93B7;font-size:12px;margin-left:auto}
h2{margin:10px 0 14px 0;color:#F7F9FF;font-size:20px}

/* è¿›åº¦æ¡ & åŒå€æç¤º */
.progress{height:8px;border-radius:999px;background:#10163A;border:1px solid #2D3565; overflow:hidden; margin-bottom:12px}
.progress > div{height:100%; background:linear-gradient(90deg,#00C2A8,#7C3AED); width:0%}
.x2banner{display:none; align-items:center; gap:8px; margin:6px 0 10px; color:#FFE8A3}
.x2banner.show{display:flex}
.x2badge{background:linear-gradient(180deg,#FFD76A,#FFA800); color:#3A2500; font-weight:900; border-radius:999px; padding:4px 10px;}

/* é€‰é¡¹ */
.options{display:grid;gap:12px}
.option{display:flex;align-items:center;gap:10px;padding:14px;border:1px solid var(--ring);border-radius:12px;background:#0F1638;cursor:pointer;transition:.2s ease; color:#DDE3FF}
.option:hover{border-color:var(--primary); box-shadow:0 6px 20px rgba(0,194,168,.25)}
.option input{appearance:none;width:18px;height:18px;border:2px solid #5460A1;border-radius:999px;display:inline-block;position:relative;background:#0B1026}
.option input:checked{border-color:var(--primary)}
.option input:checked::after{content:"";position:absolute;inset:3px;border-radius:999px;background:var(--primary)}
.option.correct{border-color:var(--ok);background:linear-gradient(180deg,#0E2B1A,#0C1E15)}
.option.wrong{border-color:var(--err);background:linear-gradient(180deg,#2A1010,#1A0D0D)}

/* æŒ‰é’® */
.actions{display:flex; gap:10px; margin-top:10px}
.btn{background:linear-gradient(180deg,#14D4BE,#00C2A8); color:#00100C;border:none;border-radius:12px;padding:12px 18px;font-weight:800;cursor:pointer;
  transition:.15s transform ease,.25s filter ease; box-shadow:0 10px 26px rgba(0,194,168,.35)}
.btn:hover{transform:translateY(-1px); filter:saturate(1.1) brightness(1.05)}
.btn:disabled{background:#374166;color:#9AA4D1;box-shadow:none;cursor:not-allowed}
.btn-ghost{background:transparent;color:#CFE;border:1px solid #3A416D;border-radius:12px;padding:12px 18px;font-weight:700;cursor:pointer}

/* åé¦ˆ */
.toast{margin-top:12px;padding:12px 14px;border-radius:12px;background:#0E1430;color:#E5EAFF;border:1px solid #2F3766}
.toast.ok{background:#0D2A1C;border-color:#1AA368;color:#CFFAE2}
.toast.err{background:#2A1212;border-color:#BE3B3B;color:#FFD0D0}
.hidden{display:none}

/* å¼¹çª— */
.modal{position:fixed; inset:0; display:none; place-items:center; background:rgba(2,6,18,.55); backdrop-filter:blur(6px); z-index:10}
.modal.show{display:grid; animation:fadeIn .2s ease}
@keyframes fadeIn{from{opacity:0} to{opacity:1}}
.modal-card{width:min(92vw,520px); background:linear-gradient(180deg,#0E1330,#0A0F25); border:1px solid #2E3664; border-radius:18px; padding:20px;
  box-shadow:0 20px 60px rgba(0,0,0,.6), inset 0 0 0 1px rgba(255,255,255,.03); transform:scale(.9); animation:popIn .25s ease forwards}
@keyframes popIn{to{transform:scale(1)}}
.modal-title{font-size:22px; font-weight:900; margin:4px 0 10px; color:#FEFEFF;
  background:linear-gradient(90deg,#B48CFF,#5CF0E1,#B48CFF); -webkit-background-clip:text; background-clip:text; color:transparent;
  animation:shimmer 2.4s linear infinite; background-size:200% 100%}
@keyframes shimmer{to{background-position:200% 0}}
.modal-body{color:#C8D1FF; font-size:14px}
.modal-qr{margin:14px 0; display:flex; align-items:center; justify-content:center}
.modal-qr .qr{width:180px;height:180px;border-radius:12px;background:linear-gradient(135deg,#121735,#0B1026);
  border:1px dashed #445; display:grid; place-items:center; color:#7EA}
.modal-actions{display:flex; gap:10px; justify-content:flex-end}
.footnote{color:#9CA3AF;text-align:center;margin:22px 0 8px 0} .tiny{font-size:12px;color:#94A3B8}
@media (max-width:480px){.page{padding:16px} h2{font-size:18px}}
</style>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&family=Poppins:wght@700;800&display=swap" rel="stylesheet">
</head>
<body>
  <!-- èƒŒæ™¯ -->
  <div class="bg-wrap">
    <div class="bg-grad"></div>
    <canvas id="bg"></canvas>
    <canvas id="fx"></canvas>
  </div>

  <main class="page">
    <section class="hero neon">
      <div class="brand">
        <div class="logo">MM</div>
        <div class="titles">
          <h1>å¢¨åŸç­”é¢˜ Â· åˆ·åˆ†åœº</h1>
          <p class="subtitle">æƒ³ç­”å‡ é¢˜å°±å‡ é¢˜ï¼›æ¯æ»¡3é¢˜ï¼Œä¸‹1é¢˜åŒå€å¥–åŠ±ï¼</p>
        </div>
        <div class="chip" id="pointsChip">å½“å‰ç§¯åˆ†ï¼š0</div>
      </div>
      <div class="statbar">
        <div class="stat" id="statAnswered">å·²ç­”ï¼š0 é¢˜</div>
        <div class="stat" id="statNext">è·ç¦»åŒå€ï¼š3 é¢˜</div>
        <div class="stat" id="statMulti">å½“å‰å€ç‡ï¼šx1</div>
      </div>
    </section>

    <section class="card" id="quizCard" aria-live="polite">
      <div class="progress"><div id="progFill"></div></div>
      <div class="x2banner" id="x2banner"><span class="x2badge">x2</span> ä¸‹ä¸€é¢˜åŒå€å¥–åŠ±ï¼Œå†²ï¼</div>

      <div class="meta">
        <span class="badge">å¿«é€Ÿåˆ·åˆ†æ¨¡å¼</span>
        <span class="muted" id="leftTime"></span>
      </div>

      <h2 id="questionText">åŠ è½½é¢˜ç›®ä¸­â€¦</h2>
      <div id="options" class="options"></div>

      <div class="actions">
        <button id="btnSubmit" class="btn neon" disabled>æäº¤ç­”æ¡ˆ</button>
        <button id="btnNext" class="btn-ghost hidden">ä¸‹ä¸€é¢˜ â†’</button>
      </div>

      <div id="feedback" class="toast hidden"></div>
    </section>

    <footer class="footnote">
      <p>ç­”é¢˜è¶Šå¤šï¼Œç§¯åˆ†è¶Šå¤šï¼›å•†æˆ·ç¤¼å“/é…’æ°´åˆ¸å¯åœ¨é¢†å¥–ä¸­å¿ƒå…‘æ¢ã€‚</p>
      <p class="tiny">æ¥ä¸Š API åå°†ä¸ä¼šå‘˜åå°å®æ—¶åŒæ­¥ç§¯åˆ†ã€‚</p>
    </footer>
  </main>

  <!-- å¥–åŠ±å¼¹çª— -->
  <div class="modal" id="rewardModal" aria-hidden="true">
    <div class="modal-card">
      <div class="modal-title">ğŸ‰ å¥–åŠ±åˆ°è´¦</div>
      <div class="modal-body">æœ¬é¢˜è·å¾— <b id="rewardDelta">+10</b> åˆ†ã€‚ç»§ç»­åˆ·é¢˜ï¼Œä¸‹ä¸€æ¬¡åŒå€æ›´çˆ½ï¼</div>
      <div class="modal-qr"><div class="qr">æ”¾ä½ çš„<br>äºŒç»´ç </div></div>
      <div class="modal-actions">
        <button class="btn-ghost" id="btnCloseModal">ç»§ç»­åˆ·é¢˜</button>
        <button class="btn" id="btnGoClaim">å»é¢†å¥–ä¸­å¿ƒ</button>
      </div>
    </div>
  </div>

<script>
/* ===== é…ç½® ===== */
const CONFIG = {
  POINTS_PER_CORRECT: 10,
  API_BASE: "", // æ¥ä¸Š Wix åç«¯å†å¡«ï¼Œå¦‚ "https://ä½ çš„åŸŸå/_functions"
  ENDPOINTS: { ME:"/me", ADD_POINTS:"/points/add", RECORD_ANSWER:"/answers/record", TODAY_QUESTION:"/questions/today" },
  API_TIMEOUT_MS: 2500,
  CLAIM_URL: "#",
  X2_EVERY: 3,         // æ¯ç­”æ»¡3é¢˜ï¼Œä¸‹ä¸€é¢˜åŒå€
  MAX_IN_LOOP: 3       // è¿›åº¦æ¡ä¸€ä¸ªå¾ªç¯çš„åŸºæ•°ï¼ˆç”¨äºè§†è§‰ï¼‰ï¼Œä¸é™åˆ¶æ€»é¢˜æ•°
};

/* ===== å·¥å…· & çŠ¶æ€ ===== */
const $ = s => document.querySelector(s);
function lsGet(k, def=null){ try{ return JSON.parse(localStorage.getItem(k)) ?? def; }catch(e){ return def; } }
function lsSet(k,v){ localStorage.setItem(k, JSON.stringify(v)); }
function fmtLeftTime(){ const end=new Date(); end.setHours(23,59,59,999); const ms=end-new Date(); const h=Math.floor(ms/3600000); const m=Math.floor((ms%3600000)/60000); return `ä»Šæ—¥å‰©ä½™ ${h}h ${m}m`; }
function shuffle(arr){ return arr.map(v=>[Math.random(),v]).sort((a,b)=>a[0]-b[0]).map(x=>x[1]); }
function setPoints(p){ state.points=p; $("#pointsChip").textContent=`å½“å‰ç§¯åˆ†ï¼š${p}`; }
function setStats(){ $("#statAnswered").textContent=`å·²ç­”ï¼š${state.answered} é¢˜`; $("#statNext").textContent=`è·ç¦»åŒå€ï¼š${state.untilX2} é¢˜`; $("#statMulti").textContent=`å½“å‰å€ç‡ï¼šx${state.mult}`; }
function setProgress(){ const base = CONFIG.MAX_IN_LOOP; const step = (state.answered % CONFIG.X2_EVERY); const pct = Math.min(99, (step/base)*100); $("#progFill").style.width = pct + "%"; $("#x2banner").classList.toggle('show', state.untilX2===0); }

/* é¢˜åº“ï¼ˆå¯æ‰©å……ï¼Œä¹Ÿå¯ç”¨åç«¯è¿”å›ï¼‰ */
const pool = [
  { title:"å¢¨å°”æœ¬å“ªæ¡å°å··ä»¥æ¶‚é¸¦é—»åï¼Ÿ", correct:"Hosier Lane", wrongs:["Hardware Lane","Degraves Street","Flinders Lane"], explanation:"Hosier Lane åœ¨è”é‚¦å¹¿åœºæ—ã€‚" },
  { title:"å¢¨å°”æœ¬å…¬å…±äº¤é€šå¡å«ï¼Ÿ", correct:"Myki", wrongs:["Opal","Go Card","Octopus"], explanation:"ç”µè½¦/ç«è½¦/å…¬äº¤éƒ½ç”¨ Mykiã€‚" },
  { title:"å“ªä¸ªåŒºä»¥åäººç¾é£Ÿè‘—ç§°ï¼Ÿ", correct:"Box Hill", wrongs:["St Kilda","Docklands","Fitzroy"], explanation:"Box Hill æ˜¯é¤é¥®çƒ­ç‚¹ã€‚" },
  { title:"MCG æ˜¯æŒ‡ä»€ä¹ˆåœºé¦†ï¼Ÿ", correct:"å¢¨å°”æœ¬æ¿çƒåœº", wrongs:["å¢¨å°”æœ¬æ­Œå‰§é™¢","å¢¨å°”æœ¬ä¼šè®®ä¸­å¿ƒ","å¢¨å°”æœ¬å±•è§ˆé¦†"], explanation:"Melbourne Cricket Groundã€‚" },
  { title:"å…è´¹ç”µè½¦åŒºä¸»è¦åœ¨å“ªï¼Ÿ", correct:"CBD å¸‚ä¸­å¿ƒèŒƒå›´", wrongs:["St Kilda å…¨åŸŸ","Box Hill å…¨åŸŸ","å…¨åŸ"], explanation:"Free Tram Zone åœ¨ CBD å†…ã€‚" }
];

/* èƒŒæ™¯æ˜Ÿå°˜ */
(function starfield(){
  const c = document.getElementById('bg'); const ctx = c.getContext('2d');
  let w=c.width=innerWidth, h=c.height=innerHeight;
  let stars = Array.from({length:140},()=>spawn());
  function spawn(){ return {x:Math.random()*w,y:Math.random()*h,r:Math.random()*1.3+0.3,s:Math.random()*0.6+0.2,a:Math.random()*1,tw:Math.random()*0.02+0.005};}
  addEventListener('resize',()=>{w=c.width=innerWidth; h=c.height=innerHeight;});
  (function tick(){
    ctx.clearRect(0,0,w,h);
    for(const s of stars){ s.y+=s.s; s.a+=s.tw; if(s.y>h+5){s.x=Math.random()*w; s.y=-5;}
      const alpha=0.35+Math.sin(s.a)*0.25; ctx.beginPath(); ctx.fillStyle=`rgba(160,220,255,${alpha})`; ctx.arc(s.x,s.y,s.r,0,Math.PI*2); ctx.fill();}
    requestAnimationFrame(tick);
  })();
})();

/* FXï¼šå½©å¸¦/é‡‘å¸ */
const FX = (function(){
  const c=document.getElementById('fx'); const ctx=c.getContext('2d');
  let w=c.width=innerWidth, h=c.height=innerHeight;
  addEventListener('resize',()=>{w=c.width=innerWidth; h=c.height=innerHeight;});
  const pieces=[];
  function burst(x,y,n=120, strength=1){
    for(let i=0;i<n;i++){
      const ang=Math.random()*Math.PI*2; const spd=(Math.random()*6+2)*strength;
      const isCoin=Math.random()<0.28;
      pieces.push({
        x,y, vx:Math.cos(ang)*spd, vy:Math.sin(ang)*spd-(isCoin?1.5:0),
        g:0.2, life:60+Math.random()*30, c:isCoin?'coin':(Math.random()<0.5?'#00C2A8':'#7C3AED'),
        r:isCoin?6:2+Math.random()*2, rot:Math.random()*Math.PI, vr:(Math.random()-.5)*0.2
      });
    }
  }
  function draw(){
    ctx.clearRect(0,0,w,h);
    for(let i=pieces.length-1;i>=0;i--){
      const p=pieces[i]; p.life--; if(p.life<=0){pieces.splice(i,1); continue;}
      p.vy+=p.g; p.x+=p.vx; p.y+=p.vy; p.rot+=p.vr;
      if(p.c==='coin'){ ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.rot);
        ctx.fillStyle='rgba(255,220,120,.95)'; ctx.beginPath(); ctx.arc(0,0,p.r,0,Math.PI*2); ctx.fill();
        ctx.strokeStyle='rgba(255,255,255,.6)'; ctx.lineWidth=1; ctx.beginPath(); ctx.arc(-p.r/3,-p.r/3,p.r/2,0,Math.PI*2); ctx.stroke(); ctx.restore();
      }else{ ctx.save(); ctx.translate(p.x,p.y); ctx.rotate(p.rot); ctx.fillStyle=p.c; ctx.fillRect(-p.r*2,-p.r/2,p.r*4,p.r); ctx.restore(); }
    }
    requestAnimationFrame(draw);
  }
  draw();
  return { burst };
})();

/* éŸ³æ•ˆ */
const SFX=(function(){ let ac; try{ac=new (window.AudioContext||window.webkitAudioContext)();}catch(e){}
  function ping(freq=880,dur=.12){ if(!ac) return; const o=ac.createOscillator(), g=ac.createGain();
    o.type='triangle'; o.frequency.value=freq; g.gain.setValueAtTime(0.001,ac.currentTime);
    g.gain.exponentialRampToValueAtTime(0.3, ac.currentTime+0.01); g.gain.exponentialRampToValueAtTime(0.001, ac.currentTime+dur);
    o.connect(g).connect(ac.destination); o.start(); o.stop(ac.currentTime+dur); }
  return { ping };
})();

/* å¼¹çª— */
function openRewardModal(delta){ $("#rewardDelta").textContent = `+${delta}`; $("#rewardModal").classList.add('show'); $("#rewardModal").setAttribute('aria-hidden','false'); }
function closeRewardModal(){ $("#rewardModal").classList.remove('show'); $("#rewardModal").setAttribute('aria-hidden','true'); }
$("#btnCloseModal").addEventListener('click', closeRewardModal);
$("#btnGoClaim").addEventListener('click', ()=>{ if(CONFIG.CLAIM_URL && CONFIG.CLAIM_URL!=="#") location.href=CONFIG.CLAIM_URL; else closeRewardModal(); });

/* çŠ¶æ€ & API */
const state={ points:0, token:null, answered:0, untilX2:CONFIG.X2_EVERY, mult:1, current:null, selected:null };
function apiBase(){ return (CONFIG.API_BASE||"").trim(); }
function withTimeout(p,ms){ return Promise.race([p,new Promise((_,rej)=>setTimeout(()=>rej(new Error("TIMEOUT")),ms))]); }
async function apiGet(path){ const url=apiBase()+path; const headers={'Content-Type':'application/json'}; if(state.token) headers.Authorization=`Bearer ${state.token}`; const res=await withTimeout(fetch(url,{headers}), CONFIG.API_TIMEOUT_MS); if(!res.ok) throw new Error("API_GET_FAILED"); return res.json(); }
async function apiPost(path,body){ const url=apiBase()+path; const headers={'Content-Type':'application/json'}; if(state.token) headers.Authorization=`Bearer ${state.token}`; const res=await withTimeout(fetch(url,{method:'POST',headers,body:JSON.stringify(body||{})}), CONFIG.API_TIMEOUT_MS); if(!res.ok) throw new Error("API_POST_FAILED"); return res.json(); }

/* æ¸²æŸ“é¢˜ç›® */
function renderQuestion(q){
  $("#questionText").textContent=q.title;
  const box=$("#options"); box.innerHTML='';
  q.options.forEach(opt=>{
    const el=document.createElement('label'); el.className='option';
    el.innerHTML=`<input type="radio" name="answer" value="${opt}" aria-label="${opt}"><span>${opt}</span>`;
    el.addEventListener('click',()=>{ state.selected=opt; $("#btnSubmit").disabled=false; });
    box.appendChild(el);
  });
  $("#btnSubmit").disabled=true;
  $("#btnNext").classList.add('hidden');
  $("#feedback").classList.add('hidden');
}

/* å–é¢˜ï¼šæœ¬åœ°éšæœºï¼ˆä¹Ÿæ”¯æŒåç«¯ï¼‰ */
async function loadQuestion(){
  $("#leftTime").textContent = fmtLeftTime();
  const q = pool[Math.floor(Math.random()*pool.length)];
  state.current = { title:q.title, correct:q.correct, explanation:q.explanation, options:shuffle([q.correct,...q.wrongs]) };
  renderQuestion(state.current);
}

/* åˆ·æ–°ç»Ÿè®¡UI */
function refreshMilestoneUI(){
  // æ˜¯å¦è¿›å…¥åŒå€çŠ¶æ€ï¼šæ¯ç­”æ»¡ X2_EVERY é¢˜ï¼Œä¸‹ä¸€é¢˜åŒå€
  state.untilX2 = (CONFIG.X2_EVERY - (state.answered % CONFIG.X2_EVERY)) % CONFIG.X2_EVERY;
  state.mult = (state.untilX2===0) ? 2 : 1;
  setStats(); setProgress();
}

/* ç»“ç®—å½“å‰é¢˜ */
async function submit(){
  if(!state.selected || !state.current) return;
  const correct = state.selected === state.current.correct;

  // é«˜äº®
  [...document.querySelectorAll('.option')].forEach(el=>{
    const v = el.querySelector('input').value;
    if(v===state.current.correct) el.classList.add('correct');
    if(v===state.selected && !correct) el.classList.add('wrong');
  });
  $("#btnSubmit").disabled=true;
  $("#btnNext").classList.remove('hidden');

  // å…ˆæ›´æ–°â€œå·²ç­”é¢˜æ•°â€ï¼Œå†è®¡ç®—ä¸‹ä¸€é¢˜æ˜¯å¦åŒå€
  state.answered += 1;
  refreshMilestoneUI(); // è¿™ä¸€æ­¥ä¹‹åï¼Œstate.mult = ä¸‹ä¸€é¢˜çš„å€ç‡ï¼›ä½†æ˜¯æˆ‘ä»¬è¦ç»™â€œæœ¬é¢˜â€çš„ç»“ç®—å€ç‡ = ä¹‹å‰çš„å€ç‡
  const nextMult = state.mult; // ä¸‹ä¸€é¢˜å€ç‡
  const thisMult = ( (state.answered-1) % CONFIG.X2_EVERY === 0 && state.answered>1 ) ? 2 : 1;
  // è§£é‡Šï¼šå½“ç­”é¢˜å‰ answered=kï¼Œè‹¥ k%3==0ï¼Œåˆ™æœ¬é¢˜æ˜¯åŒå€ï¼›æˆ‘ä»¬åœ¨ä¸Šé¢å…ˆ+1äº†ï¼Œæ‰€ä»¥ç”¨ answered-1 åˆ¤æ–­ã€‚

  if(correct){
    const base = CONFIG.POINTS_PER_CORRECT || 10;
    const delta = base * thisMult;

    try{
      if(apiBase()){
        const r = await apiPost(CONFIG.ENDPOINTS.ADD_POINTS, { delta });
        setPoints(r.points ?? (state.points + delta));
      }else{
        setPoints(state.points + delta);
        lsSet('points', state.points);
      }
    }catch(e){
      setPoints(state.points + delta);
      lsSet('points', state.points);
    }

    // FXï¼šåŒå€æ›´çŒ›
    const strength = thisMult===2 ? 1.8 : 1;
    FX.burst(innerWidth/2, innerHeight/2, 140, strength);
    SFX.ping(thisMult===2?1400:1100,.14);

    $("#feedback").className='toast ok';
    $("#feedback").textContent = `å›ç­”æ­£ç¡®ï¼${thisMult===2?'(åŒå€) ':''}+${delta} åˆ† Â· ${state.current.explanation||''}`;
    $("#feedback").classList.remove('hidden');

    // å¼¹çª—æç¤ºï¼ˆåªåœ¨åŒå€é¢˜æ—¶å¼¹ï¼‰
    if(thisMult===2){ document.getElementById('rewardDelta').textContent = `+${delta}`; openRewardModal(delta); }
  }else{
    $("#feedback").className='toast err';
    $("#feedback").textContent=`å›ç­”é”™è¯¯ï¼æ­£ç¡®ç­”æ¡ˆï¼š${state.current.correct} Â· ${state.current.explanation||''}`;
    $("#feedback").classList.remove('hidden');
    SFX.ping(320,.12);
  }

  // è®°å½•ï¼ˆå¯é€‰ï¼‰
  try{
    if(apiBase()){
      await apiPost(CONFIG.ENDPOINTS.RECORD_ANSWER, {
        selected: state.selected, correct, ts: Date.now(), mult: thisMult
      });
    }
  }catch(e){}
}

/* ä¸‹ä¸€é¢˜ */
async function nextQuestion(){
  state.selected=null;
  await loadQuestion();
  // ä¸‹ä¸€é¢˜æ˜¯å¦åŒå€çš„æç¤ºï¼ˆåˆ·æ–°é‡Œä¼šæ§åˆ¶ bannerï¼‰
  refreshMilestoneUI();
}

/* å¯åŠ¨ */
async function boot(){
  try{
    const u = new URL(location.href);
    state.token = u.searchParams.get('token') || null;
  }catch(e){}
  setPoints(lsGet('points',0));
  $("#leftTime").textContent = fmtLeftTime();
  refreshMilestoneUI();
  await loadQuestion();

  document.getElementById('btnSubmit').addEventListener('click', submit);
  document.getElementById('btnNext').addEventListener('click', nextQuestion);
}
boot();

/* èƒŒæ™¯è®¡æ—¶åˆ·æ–°ï¼ˆä»…æ˜¾ç¤ºç”¨é€”ï¼‰ */
setInterval(()=> $("#leftTime").textContent = fmtLeftTime(), 60000);
</script>
</body>
</html>
